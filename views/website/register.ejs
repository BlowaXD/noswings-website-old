<!DOCTYPE html>
<html lang="en">

<head>
    <% include shared/header.ejs %>
    <script src="/assets/plugins/jquery/jquery-3.2.1.min.js"></script>
    <script src="/assets/plugins/popper/popper.min.js"></script>
    <script src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>

    <!-- theme js -->
    <script src="/assets/js/theme.min.js"></script>
</head>

<body class="fixed-header">
<% include shared/nav.ejs %>

<!-- main -->
<section class="bg-image bg-image-sm"
         style="background-image: url('https://noswings.fr/assets/img/demo/login-background.png');">
    <div class="overlay"></div>
    <div class="container">
        <div class="row">
            <div class="col-12 col-sm-8 col-md-4 mx-auto">
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fa fa-user-plus"></i> S'inscrire sur NosWings</h4>
                    </div>
                    <div class="card-block">
                        <div class="form-group input-icon-left m-b-10">
                            <i class="fa fa-user"></i>
                            <input id="form-username" type="text" class="form-control form-control-secondary"
                                   placeholder="Identifiant">
                        </div>
                        <div class="form-group input-icon-left m-b-10">
                            <i class="fa fa-envelope"></i>
                            <input id="form-email" type="email" class="form-control form-control-secondary"
                                   placeholder="Adresse mail">
                        </div>
                        <div class="divider"><span>Sécurité</span></div>
                        <div class="form-group input-icon-left m-b-10">
                            <i class="fa fa-lock"></i>
                            <input id="form-pass" type="password" class="form-control form-control-secondary"
                                   placeholder="Mot de passe">
                        </div>
                        <div class="form-group input-icon-left m-b-10">
                            <i class="fa fa-unlock"></i>
                            <input id="form-pass2" type="password" class="form-control form-control-secondary"
                                   placeholder="Confirmer le mot de passe">
                        </div>
                        <div class="divider"><span>Je ne suis pas un robot !</span></div>
                        <div class="g-recaptcha-outer">
                            <script src='https://www.google.com/recaptcha/api.js'></script>
                            <div id="form-captcha" class="g-recaptcha"
                                 data-sitekey="6Lf-Gi0UAAAAAP-kYvvqBv9sVLn0GkGfBD0-gbCm"></div>
                        </div>
                        <div class="divider"><span>Conditions générales d'utilisation</span></div>
                        <label class="custom-control custom-checkbox custom-checkbox-primary">
                            <input id="form-cgu-check" type="checkbox" class="custom-control-input">
                            <span class="custom-control-indicator"></span>
                            <span class="custom-control-description">Accepter les <a href="#" data-toggle="modal"
                                                                                     data-target="#terms">Conditions générales d'utilisation</a></span>
                        </label>
                        <script>
                            function sendNotification(title, type) {
                                const id = 1 + Math.floor(Math.random() * 99);
                                let alert = type ? type : 'info';

                                $('body').append('<div id="notification-' + id + '" class="notification animated fadeInDown fast"><div class="alert alert-' + alert + '">' + title + '</div></div>');

                                setTimeout(function () {
                                    $('body').find('#notification-' + id).removeClass('fadeInDown').addClass('fadeOutUp');
                                }, 4000);

                                setTimeout(function () {
                                    $('body').find('#notification-' + id).remove();
                                }, 5000);
                            }

                            function resetCaptcha() {
                                grecaptcha.reset();
                            }

                            function clearPasswordFields() {
                                $('#form-pass').val('');
                                $('#form-pass2').val('');
                            }

                            function clearForm() {
                                $('#form-username').val('');
                                $('#form-email').val('');
                                clearPasswordFields();
                                resetCaptcha();
                                $('#form-cgu-check').prop('checked', false);
                            }

                            function sendRegisterRequest(data) {
                                $.ajax({
                                    type: 'POST',
                                    url: '/register',
                                    data: data,
                                    success: function (stuff) {
                                        sendNotification('Votre compte a été créé avec succès', 'success');
                                        clearForm();
                                    },
                                    error: function (xhr, status, error) {
                                        const data = JSON.parse(xhr.responseText);

                                        sendNotification('Error: ' + data.error, 'danger');
                                        resetCaptcha();
                                    },
                                    dataType: 'json'
                                });
                            }

                            function verifyData(data) {
                                if (!data.username || !data.email || !data.password || !data.passwordConfirmation) {
                                    sendNotification("Merci de remplir tous les champs du formulaire !", 'danger');
                                    return false;
                                }

                                if (data.password !== data.passwordConfirmation) {
                                    sendNotification("Les deux mots de passe ne correspondent pas !", 'danger');
                                    return false;
                                }

                                if (data.password.length < 6) {
                                    sendNotification("Merci d'utiliser un mot de passe de 6 caractères au moins !", 'danger');
                                    return false;
                                }

                                if (!document.getElementById('form-cgu-check').checked) {
                                    sendNotification("Merci d'accepter les conditions d'utilisation !", 'danger');
                                    return false;
                                }
                                return true;
                            }

                            function validateForm() {
                                const data = {
                                    username: $('#form-username').val(),
                                    email: $('#form-email').val(),
                                    password: $('#form-pass').val(),
                                    passwordConfirmation: $('#form-pass2').val(),
                                    'g-recaptcha-response': grecaptcha.getResponse(),
                                };

                                if (verifyData(data)) {
                                    sendRegisterRequest(data);
                                }
                            }
                        </script>
                        <button onclick="validateForm()" type="submit" class="btn btn-primary m-t-10 btn-block">
                            Compléter l'inscription
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="terms">
        <div class="modal-dialog modal-top" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fa fa-file-text-o"></i> Terms of Service</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <h6>1. Morbi ut pharetra tellus</h6>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras lobortis justo vel lorem sagittis,
                        eu bibendum ipsum accumsan. Donec congue eget elit ut posuere. Curabitur congue, enim a viverra
                        ultrices, elit velit auctor neque, eget vehicula
                        augue purus et lectus. Mauris cursus ac ex in vehicula. Sed ut sagittis eros. Vivamus accumsan
                        diam vitae lectus consectetur aliquet. Proin varius tempor ullamcorper. Quisque malesuada mollis
                        arcu, in euismod nisi pharetra pellentesque.
                        Sed ullamcorper quis dui sed varius. Fusce efficitur augue purus, vitae mattis orci blandit ac.
                        Integer suscipit arcu ac diam tincidunt, sed elementum augue lobortis.</p>
                    <p>Pellentesque finibus dui dui, sit amet scelerisque neque venenatis non. Nullam gravida nisi
                        pretium malesuada luctus. Nunc porttitor ipsum a massa gravida congue. Vestibulum dapibus mauris
                        sit amet volutpat faucibus. Nulla lacinia diam sed
                        ultricies venenatis. Ut ultricies, urna commodo aliquam molestie, lectus leo efficitur tellus,
                        et aliquam magna magna id est. In euismod ac magna quis imperdiet.</p>
                    <p>Aliquam ornare elit neque. Interdum et malesuada fames ac ante ipsum primis in faucibus. Morbi ut
                        pharetra tellus. Vestibulum a dui nisl. Sed commodo sodales dolor, et malesuada nulla
                        consectetur vitae. Quisque nec neque ac tellus auctor pellentesque
                        vel eleifend urna. Phasellus non urna id tellus fringilla hendrerit. Quisque vel mauris nisi.
                        Mauris nec odio vitae sapien sodales lacinia. Interdum et malesuada fames ac ante ipsum primis
                        in faucibus. Etiam sit amet nisi quis ex pretium
                        congue id id magna. Aenean dictum justo sit amet augue mollis ullamcorper. Aliquam mattis vel
                        mauris et elementum. Morbi et risus quis nisl ullamcorper pulvinar eget et erat.</p>
                    <p>Ut viverra urna non orci interdum, in viverra urna pretium. Suspendisse potenti. Mauris et massa
                        a enim lobortis facilisis. In hac habitasse platea dictumst. Ut varius erat vulputate libero
                        sagittis, vitae feugiat nibh malesuada. Sed vel lacinia
                        urna. Curabitur eget dui nisi.</p>
                    <p>Vivamus orci felis, varius tempor lacus eu, scelerisque bibendum nunc. Vestibulum rutrum, enim
                        quis maximus pretium, nisi est condimentum magna, venenatis dignissim magna nulla quis felis.
                        Quisque id tellus nec mauris sagittis mattis non et
                        quam. Etiam posuere, tellus sed tincidunt egestas, tortor orci interdum risus, nec egestas dolor
                        tortor non turpis. Curabitur in tellus laoreet, congue eros a, bibendum tortor. Nulla in
                        facilisis libero, sit amet sagittis tellus. Aliquam
                        nec pulvinar velit, mattis pharetra urna. Donec et tincidunt libero. Duis at nisi in neque
                        vulputate tempus. Curabitur et lobortis lacus. In sagittis egestas lorem, nec bibendum lacus
                        maximus sed.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Accepter</button>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- /main -->

<!-- footer -->
<% include shared/footer.ejs %>
<!-- /footer -->

</body>

</html>